@startuml
entity User {
    *id : Long <<generated>>
    --
    *username : String
    *email : String <<unique>>
    *password : String
    avatar : String
    bio : String
    location : String
    *created_at : DateTime
    *updated_at : DateTime
}

entity Role {
    *id : Long <<generated>>
    --
    *name : String <<unique>>
    *created_at : DateTime
    *updated_at : DateTime
}

entity Permission {
    *id : Long <<generated>>
    --
    *name : String <<unique>>
    *created_at : DateTime
    *updated_at : DateTime
}

entity Book {
    *id : Long <<generated>>
    --
    *title : String
    *author : String
    isbn : String <<unique>>
    description : String
    cover_url : String
    *created_at : DateTime
    *updated_at : DateTime
}

entity Category {
    *id : Long <<generated>>
    --
    *name : String <<unique>>
    *created_at : DateTime
    *updated_at : DateTime
}

entity BookCopy {
    *id : Long <<generated>>
    --
    *book_id : Long <<FK>>
    *owner_id : Long <<FK>>
    *status : String
    *created_at : DateTime
    *updated_at : DateTime
}

entity Drifting {
    *id : Long <<generated>>
    --
    *book_copy_id : Long <<FK>>
    *requester_id : Long <<FK>>
    *receiver_id : Long <<FK>>
    *status : String
    *created_at : DateTime
    *updated_at : DateTime
}

entity Message {
    *id : Long <<generated>>
    --
    *user_id : Long <<FK>>
    *content : String
    *created_at : DateTime
    *updated_at : DateTime
}

entity Comment {
    *id : Long <<generated>>
    --
    *message_id : Long <<FK>>
    *user_id : Long <<FK>>
    *content : String
    *created_at : DateTime
    *updated_at : DateTime
}

entity UserRole {
    *user_id : Long <<FK>>
    *role_id : Long <<FK>>
    --
    *created_at : DateTime
    *updated_at : DateTime
}

entity RolePermission {
    *role_id : Long <<FK>>
    *permission_id : Long <<FK>>
    --
    *created_at : DateTime
    *updated_at : DateTime
}

entity BookCategory {
    *book_id : Long <<FK>>
    *category_id : Long <<FK>>
    --
    *created_at : DateTime
    *updated_at : DateTime
}

User "1" -- "0..*" Message : posts >
User "1" -- "0..*" Comment : posts >
User "1" -- "0..*" BookCopy : owns >
User "1" -- "0..*" Drifting : initiates/receives >
User "1..*" -- "1..*" Role : has < UserRole

Role "1" -- "1..*" Permission : has < RolePermission

Book "1" -- "1..*" Category : belongs to > BookCategory
Book "1" -- "1..*" BookCopy : has >
Book "1" -- "0..*" Drifting : requested by >

Message "1" -- "0..*" Comment : has >
@enduml