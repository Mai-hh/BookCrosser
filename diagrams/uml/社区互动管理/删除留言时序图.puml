@startuml
actor User
participant MessageActivity
participant MessageFragment
participant MessageViewModel
participant MessageService
participant MessageRepository

User -> MessageActivity: 进入留言页面
activate MessageActivity

MessageActivity -> MessageFragment: 显示留言列表
activate MessageFragment

User -> MessageFragment: 长按留言
activate User
activate MessageFragment

MessageFragment -> MessageFragment: 显示删除确认对话框
deactivate MessageFragment

User -> MessageFragment: 点击"确认删除"按钮
deactivate User
activate MessageFragment

MessageFragment -> MessageViewModel: deleteMessage(messageId)
activate MessageViewModel

MessageViewModel -> MessageService: deleteMessage(messageId)
activate MessageService

MessageService -> MessageRepository: deleteById(messageId)
activate MessageRepository
MessageRepository --> MessageService: 返回删除结果
deactivate MessageRepository

MessageService --> MessageViewModel: 返回删除结果
deactivate MessageService

alt 删除成功
    MessageViewModel --> MessageFragment: 返回删除成功结果
else 删除失败
    MessageViewModel --> MessageFragment: 返回删除失败结果
end
deactivate MessageViewModel

alt 删除成功
    MessageFragment -> MessageActivity: 刷新留言列表
    deactivate MessageFragment

    MessageActivity -> MessageFragment: 显示更新后的留言列表
    activate MessageFragment
    deactivate MessageFragment
else 删除失败
    MessageFragment -> User: 显示删除失败提示
    deactivate MessageFragment
end

User -> MessageActivity: 退出留言页面
deactivate User
deactivate MessageActivity
@enduml