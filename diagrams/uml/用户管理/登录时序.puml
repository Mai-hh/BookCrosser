@startuml
actor User
participant MainActivity
participant LoginScreen
participant LoginViewModel
participant AuthRepository
participant UserRepository
participant JWTService

User -> MainActivity: 进入登录页面
MainActivity -> LoginScreen: 显示登录表单

User -> LoginScreen: 填写登录信息
User -> LoginScreen: 提交登录表单

LoginScreen -> LoginViewModel: login()

LoginViewModel -> LoginViewModel: 校验表单数据
alt 表单数据无效
    LoginViewModel -> LoginScreen: 返回表单验证错误
    LoginScreen -> User: 显示错误提示
else 表单数据有效
    LoginViewModel -> AuthRepository: authenticate()

    AuthRepository -> UserRepository: findByUsername()
    UserRepository -> AuthRepository: 返回用户信息

    alt 用户名不存在
        AuthRepository -> LoginViewModel: 返回用户不存在错误
        LoginViewModel -> LoginScreen: 显示错误提示
        LoginScreen -> User: 显示错误提示
    else 用户名存在
        AuthRepository -> AuthRepository: 验证密码
        alt 密码错误
            AuthRepository -> LoginViewModel: 返回密码错误
            LoginViewModel -> LoginScreen: 显示错误提示
            LoginScreen -> User: 显示错误提示
        else 密码正确
            AuthRepository -> JWTService: generateToken()
            JWTService -> AuthRepository: 返回JWT token

            AuthRepository -> LoginViewModel: 返回登录成功
            LoginViewModel -> LoginScreen: 显示登录成功提示
            LoginScreen -> User: 显示登录成功提示

            LoginScreen -> MainActivity: 跳转到主页面
            MainActivity -> User: 显示主页面
        end
    end
end
@enduml