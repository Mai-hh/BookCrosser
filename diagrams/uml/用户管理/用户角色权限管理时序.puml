@startuml
actor Admin
participant RoleManagementActivity
participant RoleListFragment
participant RoleViewModel
participant RoleService
participant RoleRepository
participant PermissionRepository

Admin -> RoleManagementActivity: 进入角色管理页面
RoleManagementActivity -> RoleListFragment: 显示角色列表

RoleListFragment -> RoleViewModel: getRoleList()
RoleViewModel -> RoleService: getAllRoles()
RoleService -> RoleRepository: findAll()
RoleRepository -> RoleService: 返回角色列表
RoleService -> RoleViewModel: 返回角色列表
RoleViewModel -> RoleListFragment: 更新角色列表显示

Admin -> RoleListFragment: 点击添加角色按钮
RoleListFragment -> RoleViewModel: createRole()
RoleViewModel -> RoleService: createRole()
RoleService -> RoleRepository: save()
RoleRepository -> RoleService: 返回新创建的角色
RoleService -> RoleViewModel: 返回新创建的角色
RoleViewModel -> RoleListFragment: 更新角色列表显示

Admin -> RoleListFragment: 点击编辑角色按钮
RoleListFragment -> RoleViewModel: getRoleById()
RoleViewModel -> RoleService: getRoleById()
RoleService -> RoleRepository: findById()
RoleRepository -> RoleService: 返回角色信息
RoleService -> RoleViewModel: 返回角色信息
RoleViewModel -> RoleListFragment: 显示角色编辑页面

Admin -> RoleListFragment: 修改角色信息
Admin -> RoleListFragment: 点击保存按钮
RoleListFragment -> RoleViewModel: updateRole()
RoleViewModel -> RoleService: updateRole()
RoleService -> RoleRepository: save()
RoleRepository -> RoleService: 返回更新后的角色信息
RoleService -> RoleViewModel: 返回更新后的角色信息
RoleViewModel -> RoleListFragment: 更新角色列表显示

Admin -> RoleListFragment: 点击删除角色按钮
RoleListFragment -> RoleViewModel: deleteRole()
RoleViewModel -> RoleService: deleteRole()
RoleService -> RoleRepository: deleteById()
RoleRepository -> RoleService: 返回删除结果
RoleService -> RoleViewModel: 返回删除结果
RoleViewModel -> RoleListFragment: 更新角色列表显示

Admin -> RoleListFragment: 点击分配权限按钮
RoleListFragment -> RoleViewModel: getPermissionsByRoleId()
RoleViewModel -> RoleService: getPermissionsByRoleId()
RoleService -> PermissionRepository: findByRoleId()
PermissionRepository -> RoleService: 返回权限列表
RoleService -> RoleViewModel: 返回权限列表
RoleViewModel -> RoleListFragment: 显示权限分配页面

Admin -> RoleListFragment: 修改权限分配
Admin -> RoleListFragment: 点击保存按钮
RoleListFragment -> RoleViewModel: updateRolePermissions()
RoleViewModel -> RoleService: updateRolePermissions()
RoleService -> PermissionRepository: deleteByRoleId()
PermissionRepository -> RoleService: 返回删除结果
RoleService -> PermissionRepository: saveAll()
PermissionRepository -> RoleService: 返回新增的权限信息
RoleService -> RoleViewModel: 返回更新后的权限信息
RoleViewModel -> RoleListFragment: 显示更新成功提示
@enduml