@startuml
actor User
participant BookSearchActivity
participant BookSearchFragment
participant BookSearchViewModel
participant BookService
participant CategoryService
participant BookRepository

User -> BookSearchActivity: 进入图书检索页面
activate BookSearchActivity

BookSearchActivity -> BookSearchFragment: 显示图书检索界面
activate BookSearchFragment

User -> BookSearchFragment: 输入检索关键词
User -> BookSearchFragment: 选择检索条件(作者、ISBN等)
User -> BookSearchFragment: 点击检索按钮

BookSearchFragment -> BookSearchViewModel: searchBooks(keyword, conditions)
activate BookSearchViewModel

alt 按分类检索
    BookSearchViewModel -> CategoryService: getCategories()
    activate CategoryService
    CategoryService --> BookSearchViewModel: List<Category>
    deactivate CategoryService

    BookSearchViewModel -> BookService: searchBooksByCategory(keyword, categoryId)
    activate BookService
else 按其他条件检索
    BookSearchViewModel -> BookService: searchBooks(keyword, conditions)
    activate BookService
end

BookService -> BookRepository: findByKeywordAndConditions(keyword, conditions)
activate BookRepository
BookRepository --> BookService: List<Book>
deactivate BookRepository

BookService --> BookSearchViewModel: List<Book>
deactivate BookService

BookSearchViewModel --> BookSearchFragment: 检索结果
deactivate BookSearchViewModel

alt 检索结果不为空
    BookSearchFragment -> User: 显示检索结果列表
else 检索结果为空
    BookSearchFragment -> User: 显示"无匹配图书"提示
end

User -> BookSearchFragment: 点击图书条目
BookSearchFragment -> BookSearchActivity: 打开图书详情页面
deactivate BookSearchFragment

BookSearchActivity -> User: 显示图书详情
deactivate BookSearchActivity
@enduml