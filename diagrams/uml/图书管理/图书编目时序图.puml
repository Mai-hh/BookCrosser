@startuml
actor Librarian
participant BookCatalogingActivity
participant BookCatalogingFragment
participant BookCatalogingViewModel
participant BookService
participant CategoryService
participant BookRepository

Librarian -> BookCatalogingActivity: 进入图书编目页面
activate BookCatalogingActivity

BookCatalogingActivity -> BookCatalogingFragment: 显示图书编目表单
activate BookCatalogingFragment

BookCatalogingFragment -> BookCatalogingViewModel: getBookDetails(bookId)
activate BookCatalogingViewModel

BookCatalogingViewModel -> BookService: getBookById(bookId)
activate BookService

BookService -> BookRepository: findById(bookId)
activate BookRepository
BookRepository --> BookService: Book
deactivate BookRepository

BookService --> BookCatalogingViewModel: Book
deactivate BookService

BookCatalogingViewModel -> CategoryService: getCategories()
activate CategoryService
CategoryService --> BookCatalogingViewModel: List<Category>
deactivate CategoryService

BookCatalogingViewModel --> BookCatalogingFragment: Book, List<Category>
deactivate BookCatalogingViewModel

BookCatalogingFragment -> Librarian: 显示图书详情和编目表单

Librarian -> BookCatalogingFragment: 填写编目信息
activate Librarian
deactivate Librarian

Librarian -> BookCatalogingFragment: 点击保存按钮
activate Librarian
deactivate Librarian

BookCatalogingFragment -> BookCatalogingViewModel: saveBookCataloging(book, catalogingInfo)
activate BookCatalogingViewModel

BookCatalogingViewModel -> BookService: updateBook(book)
activate BookService

BookService -> BookRepository: save(book)
activate BookRepository
BookRepository --> BookService: Book
deactivate BookRepository

BookService --> BookCatalogingViewModel: Book
deactivate BookService

BookCatalogingViewModel --> BookCatalogingFragment: 编目保存结果
deactivate BookCatalogingViewModel

BookCatalogingFragment -> Librarian: 显示编目保存结果
deactivate BookCatalogingFragment

Librarian -> BookCatalogingActivity: 返回图书列表
deactivate BookCatalogingActivity
@enduml